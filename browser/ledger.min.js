(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.ledger=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(Buffer){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _utils=require("./utils");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var MAX_SCRIPT_BLOCK=50;var DEFAULT_LOCKTIME=0;var DEFAULT_SEQUENCE=4294967295;var SIGHASH_ALL=1;var LedgerBtc=function(){function LedgerBtc(comm){_classCallCheck(this,LedgerBtc);this.comm=comm;comm.setScrambleKey("BTC")}_createClass(LedgerBtc,[{key:"getWalletPublicKey_async",value:function getWalletPublicKey_async(path){var paths=(0,_utils.splitPath)(path);var buffer=Buffer.alloc(5+1+paths.length*4);buffer[0]=224;buffer[1]=64;buffer[2]=0;buffer[3]=0;buffer[4]=1+paths.length*4;buffer[5]=paths.length;paths.forEach(function(element,index){buffer.writeUInt32BE(element,6+4*index)});return this.comm.exchange(buffer.toString("hex"),[36864]).then(function(responseHex){var response=Buffer.from(responseHex,"hex");var publicKeyLength=response[0];var addressLength=response[1+publicKeyLength];var publicKey=response.slice(1,1+publicKeyLength).toString("hex");var bitcoinAddress=response.slice(1+publicKeyLength+1,1+publicKeyLength+1+addressLength).toString("ascii");var chainCode=response.slice(1+publicKeyLength+1+addressLength,1+publicKeyLength+1+addressLength+32).toString("hex");return{publicKey:publicKey,bitcoinAddress:bitcoinAddress,chainCode:chainCode}})}},{key:"getTrustedInputRaw_async",value:function getTrustedInputRaw_async(transactionData,indexLookup){var data=void 0;var firstRound=false;if(typeof indexLookup==="number"){firstRound=true;var prefix=Buffer.alloc(4);prefix.writeUInt32BE(indexLookup,0);data=Buffer.concat([prefix,transactionData],transactionData.length+4)}else{data=transactionData}var buffer=Buffer.alloc(5);buffer[0]=224;buffer[1]=66;buffer[2]=firstRound?0:128;buffer[3]=0;buffer[4]=data.length;buffer=Buffer.concat([buffer,data],5+data.length);return this.comm.exchange(buffer.toString("hex"),[36864]).then(function(trustedInput){return trustedInput.substring(0,trustedInput.length-4)})}},{key:"getTrustedInput_async",value:function getTrustedInput_async(indexLookup,transaction){var _this=this;var inputs=transaction.inputs,outputs=transaction.outputs,locktime=transaction.locktime;if(!outputs||!locktime){throw new Error("getTrustedInput_async: locktime & outputs is expected")}var processScriptBlocks=function processScriptBlocks(script,sequence){var scriptBlocks=[];var offset=0;while(offset!==script.length){var blockSize=script.length-offset>MAX_SCRIPT_BLOCK?MAX_SCRIPT_BLOCK:script.length-offset;if(offset+blockSize!==script.length){scriptBlocks.push(script.slice(offset,offset+blockSize))}else{scriptBlocks.push(Buffer.concat([script.slice(offset,offset+blockSize),sequence]))}offset+=blockSize}return(0,_utils.eachSeries)(scriptBlocks,function(scriptBlock){return _this.getTrustedInputRaw_async(scriptBlock)})};var processInputs=function processInputs(){return(0,_utils.eachSeries)(inputs,function(input){var data=Buffer.concat([input.prevout,_this.createVarint(input.script.length)]);return _this.getTrustedInputRaw_async(data).then(function(){return processScriptBlocks(input.script,input.sequence)})}).then(function(){var data=_this.createVarint(outputs.length);return _this.getTrustedInputRaw_async(data)})};var processOutputs=function processOutputs(){return(0,_utils.eachSeries)(outputs,function(output){var data=output.amount;data=Buffer.concat([data,_this.createVarint(output.script.length),output.script]);return _this.getTrustedInputRaw_async(data).then(function(){})}).then(function(){return _this.getTrustedInputRaw_async(locktime)})};var data=Buffer.concat([transaction.version,this.createVarint(inputs.length)]);return this.getTrustedInputRaw_async(data,indexLookup).then(processInputs).then(processOutputs)}},{key:"getVarint",value:function getVarint(data,offset){if(data[offset]<253){return[data[offset],1]}if(data[offset]===253){return[(data[offset+2]<<8)+data[offset+1],3]}if(data[offset]===254){return[(data[offset+4]<<24)+(data[offset+3]<<16)+(data[offset+2]<<8)+data[offset+1],5]}throw new Error("getVarint called with unexpected parameters")}},{key:"startUntrustedHashTransactionInputRaw_async",value:function startUntrustedHashTransactionInputRaw_async(newTransaction,firstRound,transactionData){var buffer=Buffer.alloc(5);buffer[0]=224;buffer[1]=68;buffer[2]=firstRound?0:128;buffer[3]=newTransaction?0:128;buffer[4]=transactionData.length;buffer=Buffer.concat([buffer,transactionData],5+transactionData.length);return this.comm.exchange(buffer.toString("hex"),[36864])}},{key:"startUntrustedHashTransactionInput_async",value:function startUntrustedHashTransactionInput_async(newTransaction,transaction,inputs){var _this2=this;var data=Buffer.concat([transaction.version,this.createVarint(transaction.inputs.length)]);return this.startUntrustedHashTransactionInputRaw_async(newTransaction,true,data).then(function(){var i=0;return(0,_utils.eachSeries)(transaction.inputs,function(input){var prefix=void 0;if(inputs[i].trustedInput){prefix=Buffer.alloc(2);prefix[0]=1;prefix[1]=inputs[i].value.length}else{prefix=Buffer.alloc(1);prefix[0]=0}data=Buffer.concat([prefix,inputs[i].value,_this2.createVarint(input.script.length)]);return _this2.startUntrustedHashTransactionInputRaw_async(newTransaction,false,data).then(function(){var scriptBlocks=[];var offset=0;if(input.script.length===0){scriptBlocks.push(input.sequence)}else{while(offset!==input.script.length){var blockSize=input.script.length-offset>MAX_SCRIPT_BLOCK?MAX_SCRIPT_BLOCK:input.script.length-offset;if(offset+blockSize!==input.script.length){scriptBlocks.push(input.script.slice(offset,offset+blockSize))}else{scriptBlocks.push(Buffer.concat([input.script.slice(offset,offset+blockSize),input.sequence]))}offset+=blockSize}}return(0,_utils.eachSeries)(scriptBlocks,function(scriptBlock){return _this2.startUntrustedHashTransactionInputRaw_async(newTransaction,false,scriptBlock)}).then(function(){i++})})})})}},{key:"provideOutputFullChangePath_async",value:function provideOutputFullChangePath_async(path){var paths=(0,_utils.splitPath)(path);var buffer=Buffer.alloc(5+1+paths.length*4);buffer[0]=224;buffer[1]=74;buffer[2]=255;buffer[3]=0;buffer[4]=1+paths.length*4;buffer[5]=paths.length;paths.forEach(function(element,index){buffer.writeUInt32BE(element,6+4*index)});return this.comm.exchange(buffer.toString("hex"),[36864])}},{key:"hashOutputFull_async",value:function hashOutputFull_async(outputScript){var _this3=this;var offset=0;return(0,_utils.asyncWhile)(function(){return offset<outputScript.length},function(){var blockSize=offset+MAX_SCRIPT_BLOCK>=outputScript.length?outputScript.length-offset:MAX_SCRIPT_BLOCK;var p1=offset+blockSize===outputScript.length?128:0;var prefix=Buffer.alloc(5);prefix[0]=224;prefix[1]=74;prefix[2]=p1;prefix[3]=0;prefix[4]=blockSize;var data=Buffer.concat([prefix,outputScript.slice(offset,offset+blockSize)]);return _this3.comm.exchange(data.toString("hex"),[36864]).then(function(){offset+=blockSize})})}},{key:"signTransaction_async",value:function signTransaction_async(path){var lockTime=arguments.length>1&&arguments[1]!==undefined?arguments[1]:DEFAULT_LOCKTIME;var sigHashType=arguments.length>2&&arguments[2]!==undefined?arguments[2]:SIGHASH_ALL;var paths=(0,_utils.splitPath)(path);var buffer=Buffer.alloc(5+1+paths.length*4+1+4+1);var offset=0;buffer[offset++]=224;buffer[offset++]=72;buffer[offset++]=0;buffer[offset++]=0;buffer[offset++]=1+paths.length*4+1+4+1;buffer[offset++]=paths.length;paths.forEach(function(element){buffer.writeUInt32BE(element,offset);offset+=4});buffer[offset++]=0;buffer.writeUInt32LE(lockTime,offset);offset+=4;buffer[offset++]=sigHashType;return this.comm.exchange(buffer.toString("hex"),[36864]).then(function(signature){var result=Buffer.from(signature,"hex");result[0]=48;return result.slice(0,result.length-2)})}},{key:"signMessageNew_async",value:function signMessageNew_async(path,messageHex){var _this4=this;var paths=(0,_utils.splitPath)(path);var message=new Buffer(messageHex,"hex");var offset=0;var apdus=[];var _loop=function _loop(){var maxChunkSize=offset===0?MAX_SCRIPT_BLOCK-1-paths.length*4-4:MAX_SCRIPT_BLOCK;var chunkSize=offset+maxChunkSize>message.length?message.length-offset:maxChunkSize;var buffer=new Buffer(offset===0?5+1+paths.length*4+2+chunkSize:5+chunkSize);buffer[0]=224;buffer[1]=78;buffer[2]=0;buffer[3]=offset===0?1:128;buffer[4]=offset===0?1+paths.length*4+2+chunkSize:chunkSize;if(offset===0){buffer[5]=paths.length;paths.forEach(function(element,index){buffer.writeUInt32BE(element,6+4*index)});buffer.writeUInt16BE(message.length,6+4*paths.length);message.copy(buffer,6+4*paths.length+2,offset,offset+chunkSize)}else{message.copy(buffer,5,offset,offset+chunkSize)}apdus.push(buffer.toString("hex"));offset+=chunkSize};while(offset!==message.length){_loop()}return(0,_utils.foreach)(apdus,function(apdu){return _this4.comm.exchange(apdu,[36864])}).then(function(){var buffer=Buffer.alloc(6);buffer[0]=224;buffer[1]=78;buffer[2]=128;buffer[3]=0;buffer[4]=1;buffer[5]=0;return _this4.comm.exchange(buffer.toString("hex"),[36864]).then(function(apduResponse){var response=Buffer.from(apduResponse,"hex");var v=response[0]-48;var r=response.slice(4,4+response[3]);if(r[0]===0){r=r.slice(1)}r=r.toString("hex");var offset=4+response[3]+2;var s=response.slice(offset,offset+response[offset-1]);if(s[0]===0){s=s.slice(1)}s=s.toString("hex");return{v:v,r:r,s:s}})})}},{key:"createPaymentTransactionNew_async",value:function createPaymentTransactionNew_async(inputs,associatedKeysets,changePath,outputScriptHex){var _this5=this;var lockTime=arguments.length>4&&arguments[4]!==undefined?arguments[4]:DEFAULT_LOCKTIME;var sigHashType=arguments.length>5&&arguments[5]!==undefined?arguments[5]:SIGHASH_ALL;var nullScript=Buffer.alloc(0);var nullPrevout=Buffer.alloc(0);var defaultVersion=Buffer.alloc(4);defaultVersion.writeUInt32LE(1,0);var trustedInputs=[];var regularOutputs=[];var signatures=[];var publicKeys=[];var firstRun=true;var resuming=false;var targetTransaction={inputs:[],version:defaultVersion};var outputScript=Buffer.from(outputScriptHex,"hex");return(0,_utils.foreach)(inputs,function(input){return(0,_utils.doIf)(!resuming,function(){return _this5.getTrustedInput_async(input[1],input[0]).then(function(trustedInput){trustedInputs.push({trustedInput:true,value:Buffer.from(trustedInput,"hex")})})}).then(function(){var outputs=input[0].outputs;var index=input[1];if(outputs&&index<=outputs.length-1){regularOutputs.push(outputs[index])}})}).then(function(){for(var i=0;i<inputs.length;i++){var _sequence=Buffer.alloc(4);_sequence.writeUInt32LE(inputs[i].length>=4&&typeof inputs[i][3]==="number"?inputs[i][3]:DEFAULT_SEQUENCE,0);targetTransaction.inputs.push({script:nullScript,prevout:nullPrevout,sequence:_sequence})}}).then(function(){return(0,_utils.doIf)(!resuming,function(){return(0,_utils.foreach)(inputs,function(input,i){return _this5.getWalletPublicKey_async(associatedKeysets[i])}).then(function(result){for(var index=0;index<result.length;index++){publicKeys.push(_this5.compressPublicKey(Buffer.from(result[index].publicKey,"hex")))}})})}).then(function(){return(0,_utils.foreach)(inputs,function(input,i){targetTransaction.inputs[i].script=inputs[i].length>=3&&typeof inputs[i][2]==="string"?Buffer.from(inputs[i][2],"hex"):regularOutputs[i].script;return _this5.startUntrustedHashTransactionInput_async(firstRun,targetTransaction,trustedInputs).then(function(){return Promise.resolve().then(function(){if(!resuming&&typeof changePath!=="undefined"){return _this5.provideOutputFullChangePath_async(changePath)}}).then(function(){return _this5.hashOutputFull_async(outputScript)}).then(function(){return _this5.signTransaction_async(associatedKeysets[i],lockTime,sigHashType).then(function(signature){signatures.push(signature);targetTransaction.inputs[i].script=nullScript;if(firstRun){firstRun=false}})})})})}).then(function(){for(var i=0;i<inputs.length;i++){var signatureSize=Buffer.alloc(1);var keySize=Buffer.alloc(1);signatureSize[0]=signatures[i].length;keySize[0]=publicKeys[i].length;targetTransaction.inputs[i].script=Buffer.concat([signatureSize,signatures[i],keySize,publicKeys[i]]);targetTransaction.inputs[i].prevout=trustedInputs[i].value.slice(4,4+36)}var lockTimeBuffer=Buffer.alloc(4);lockTimeBuffer.writeUInt32LE(lockTime,0);var result=Buffer.concat([_this5.serializeTransaction(targetTransaction),outputScript,lockTimeBuffer]);return result.toString("hex")})}},{key:"signP2SHTransaction_async",value:function signP2SHTransaction_async(inputs,associatedKeysets,outputScriptHex){var _this6=this;var lockTime=arguments.length>3&&arguments[3]!==undefined?arguments[3]:DEFAULT_LOCKTIME;var sigHashType=arguments.length>4&&arguments[4]!==undefined?arguments[4]:SIGHASH_ALL;var nullScript=Buffer.alloc(0);var nullPrevout=Buffer.alloc(0);var defaultVersion=Buffer.alloc(4);defaultVersion.writeUInt32LE(1,0);var trustedInputs=[];var regularOutputs=[];var signatures=[];var firstRun=true;var resuming=false;var targetTransaction={inputs:[],version:defaultVersion};var outputScript=Buffer.from(outputScriptHex,"hex");return(0,_utils.foreach)(inputs,function(input){return(0,_utils.doIf)(!resuming,function(){return _this6.getTrustedInput_async(input[1],input[0]).then(function(trustedInput){var inputItem={};inputItem.trustedInput=false;inputItem.value=Buffer.from(trustedInput,"hex").slice(4,4+36);trustedInputs.push(inputItem)})}).then(function(){var outputs=input[0].outputs;var index=input[1];if(outputs&&index<=outputs.length-1){regularOutputs.push(outputs[index])}})}).then(function(){for(var i=0;i<inputs.length;i++){var tmp=Buffer.alloc(4);var _sequence2=void 0;if(inputs[i].length>=4&&typeof inputs[i][3]==="number"){_sequence2=inputs[i][3]}else{_sequence2=DEFAULT_SEQUENCE}tmp.writeUInt32LE(_sequence2,0);targetTransaction.inputs.push({prevout:nullPrevout,script:nullScript,sequence:tmp})}}).then(function(){return(0,_utils.foreach)(inputs,function(input,i){targetTransaction.inputs[i].script=inputs[i].length>=3&&typeof inputs[i][2]==="string"?Buffer.from(inputs[i][2],"hex"):regularOutputs[i].script;return _this6.startUntrustedHashTransactionInput_async(firstRun,targetTransaction,trustedInputs).then(function(){return _this6.hashOutputFull_async(outputScript)}).then(function(){return _this6.signTransaction_async(associatedKeysets[i],lockTime,sigHashType).then(function(signature){signatures.push(signature.slice(0,signature.length-1).toString("hex"));targetTransaction.inputs[i].script=nullScript;if(firstRun){firstRun=false}})})})}).then(function(){return signatures})}},{key:"compressPublicKey",value:function compressPublicKey(publicKey){var prefix=(publicKey[64]&1)!==0?3:2;var prefixBuffer=Buffer.alloc(1);prefixBuffer[0]=prefix;return Buffer.concat([prefixBuffer,publicKey.slice(1,1+32)])}},{key:"createVarint",value:function createVarint(value){if(value<253){var _buffer=Buffer.alloc(1);_buffer[0]=value;return _buffer}if(value<=65535){var _buffer2=Buffer.alloc(3);_buffer2[0]=253;_buffer2[1]=value&255;_buffer2[2]=value>>8&255;return _buffer2}var buffer=Buffer.alloc(4);buffer[0]=254;buffer[1]=value&255;buffer[2]=value>>8&255;buffer[3]=value>>16&255;buffer[4]=value>>24&255;return buffer}},{key:"splitTransaction",value:function splitTransaction(transactionHex){var inputs=[];var outputs=[];var offset=0;var transaction=Buffer.from(transactionHex,"hex");var version=transaction.slice(offset,offset+4);offset+=4;var varint=this.getVarint(transaction,offset);var numberInputs=varint[0];offset+=varint[1];for(var i=0;i<numberInputs;i++){var _prevout=transaction.slice(offset,offset+36);offset+=36;varint=this.getVarint(transaction,offset);offset+=varint[1];var _script=transaction.slice(offset,offset+varint[0]);offset+=varint[0];var _sequence3=transaction.slice(offset,offset+4);offset+=4;inputs.push({prevout:_prevout,script:_script,sequence:_sequence3})}varint=this.getVarint(transaction,offset);var numberOutputs=varint[0];offset+=varint[1];for(var _i=0;_i<numberOutputs;_i++){var _amount=transaction.slice(offset,offset+8);offset+=8;varint=this.getVarint(transaction,offset);offset+=varint[1];var _script2=transaction.slice(offset,offset+varint[0]);offset+=varint[0];outputs.push({amount:_amount,script:_script2})}var locktime=transaction.slice(offset,offset+4);return{version:version,inputs:inputs,outputs:outputs,locktime:locktime}}},{key:"serializeTransactionOutputs",value:function serializeTransactionOutputs(_ref){var _this7=this;var outputs=_ref.outputs;var outputBuffer=Buffer.alloc(0);if(typeof outputs!=="undefined"){outputBuffer=Buffer.concat([outputBuffer,this.createVarint(outputs.length)]);outputs.forEach(function(output){outputBuffer=Buffer.concat([outputBuffer,output.amount,_this7.createVarint(output.script.length),output.script])})}return outputBuffer}},{key:"serializeTransaction",value:function serializeTransaction(transaction){var _this8=this;var inputBuffer=Buffer.alloc(0);transaction.inputs.forEach(function(input){inputBuffer=Buffer.concat([inputBuffer,input.prevout,_this8.createVarint(input.script.length),input.script,input.sequence])});var outputBuffer=this.serializeTransactionOutputs(transaction);if(typeof transaction.outputs!=="undefined"&&typeof transaction.locktime!=="undefined"){outputBuffer=Buffer.concat([outputBuffer,transaction.locktime])}return Buffer.concat([transaction.version,this.createVarint(transaction.inputs.length),inputBuffer,outputBuffer])}},{key:"displayTransactionDebug",value:function displayTransactionDebug(transaction){console.log("version "+transaction.version.toString("hex"));transaction.inputs.forEach(function(input,i){var prevout=input.prevout.toString("hex");var script=input.script.toString("hex");var sequence=input.sequence.toString("hex");console.log("input "+i+" prevout "+prevout+" script "+script+" sequence "+sequence)});(transaction.outputs||[]).forEach(function(output,i){var amount=output.amount.toString("hex");var script=output.script.toString("hex");console.log("output "+i+" amount "+amount+" script "+script)});if(typeof transaction.locktime!=="undefined"){console.log("locktime "+transaction.locktime.toString("hex"))}}}]);return LedgerBtc}();exports.default=LedgerBtc}).call(this,require("buffer").Buffer)},{"./utils":6,buffer:8}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var LedgerComm=function LedgerComm(){_classCallCheck(this,LedgerComm)};exports.default=LedgerComm},{}],3:[function(require,module,exports){(function(Buffer){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _u2fApi=require("u2f-api");var _LedgerComm2=require("./LedgerComm");var _LedgerComm3=_interopRequireDefault(_LedgerComm2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}function wrapApdu(apdu,key){var result=Buffer.alloc(apdu.length);for(var i=0;i<apdu.length;i++){result[i]=apdu[i]^key[i%key.length]}return result}var webSafe64=function webSafe64(base64){return base64.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")};var normal64=function normal64(base64){return base64.replace(/-/g,"+").replace(/_/g,"/")+"==".substring(0,3*base64.length%4)};function u2fPromise(response,statusList){var signatureData=response.signatureData;return new Promise(function(resolve,reject){if(typeof signatureData==="string"){var data=Buffer.from(normal64(signatureData),"base64");if(typeof statusList!=="undefined"){var sw=data.readUInt16BE(data.length-2);var statusFound=statusList.some(function(s){return s===sw});if(!statusFound){reject("Invalid status "+sw.toString(16))}}resolve(data.toString("hex",5))}else{reject(response)}})}var LedgerU2F=function(_LedgerComm){_inherits(LedgerU2F,_LedgerComm);function LedgerU2F(){var timeoutSeconds=arguments.length>0&&arguments[0]!==undefined?arguments[0]:20;_classCallCheck(this,LedgerU2F);var _this=_possibleConstructorReturn(this,(LedgerU2F.__proto__||Object.getPrototypeOf(LedgerU2F)).call(this));_this.timeoutSeconds=timeoutSeconds;return _this}_createClass(LedgerU2F,[{key:"exchange",value:function exchange(apduHex,statusList){var apdu=Buffer.from(apduHex,"hex");var keyHandle=wrapApdu(apdu,this.scrambleKey);var challenge=Buffer.from("0000000000000000000000000000000000000000000000000000000000000000","hex");var signRequest={version:"U2F_V2",keyHandle:webSafe64(keyHandle.toString("base64")),challenge:webSafe64(challenge.toString("base64")),appId:location.origin};return(0,_u2fApi.sign)(signRequest,this.timeoutSeconds).then(function(result){return u2fPromise(result,statusList)})}},{key:"setScrambleKey",value:function setScrambleKey(scrambleKey){this.scrambleKey=Buffer.from(scrambleKey,"ascii")}},{key:"close_async",value:function close_async(){return Promise.resolve()}}]);return LedgerU2F}(_LedgerComm3.default);LedgerU2F.create_async=function(timeout){return Promise.resolve(new LedgerU2F(timeout))};exports.default=LedgerU2F}).call(this,require("buffer").Buffer)},{"./LedgerComm":2,buffer:8,"u2f-api":10}],4:[function(require,module,exports){(function(Buffer){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _utils=require("./utils");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var LedgerEth=function(){function LedgerEth(comm){_classCallCheck(this,LedgerEth);this.comm=comm;comm.setScrambleKey("w0w")}_createClass(LedgerEth,[{key:"getAddress_async",value:function getAddress_async(path,boolDisplay,boolChaincode){var paths=(0,_utils.splitPath)(path);var buffer=new Buffer(5+1+paths.length*4);buffer[0]=224;buffer[1]=2;buffer[2]=boolDisplay?1:0;buffer[3]=boolChaincode?1:0;buffer[4]=1+paths.length*4;buffer[5]=paths.length;paths.forEach(function(element,index){buffer.writeUInt32BE(element,6+4*index)});return this.comm.exchange(buffer.toString("hex"),[36864]).then(function(responseHex){var result={};var response=new Buffer(responseHex,"hex");var publicKeyLength=response[0];var addressLength=response[1+publicKeyLength];result.publicKey=response.slice(1,1+publicKeyLength).toString("hex");result.address="0x"+response.slice(1+publicKeyLength+1,1+publicKeyLength+1+addressLength).toString("ascii");if(boolChaincode){result.chainCode=response.slice(1+publicKeyLength+1+addressLength,1+publicKeyLength+1+addressLength+32).toString("hex")}return result})}},{key:"signTransaction_async",value:function signTransaction_async(path,rawTxHex){var _this=this;var paths=(0,_utils.splitPath)(path);var offset=0;var rawTx=new Buffer(rawTxHex,"hex");var apdus=[];var response=[];var _loop=function _loop(){var maxChunkSize=offset===0?150-1-paths.length*4:150;var chunkSize=offset+maxChunkSize>rawTx.length?rawTx.length-offset:maxChunkSize;var buffer=new Buffer(offset===0?5+1+paths.length*4+chunkSize:5+chunkSize);buffer[0]=224;buffer[1]=4;buffer[2]=offset===0?0:128;buffer[3]=0;buffer[4]=offset===0?1+paths.length*4+chunkSize:chunkSize;if(offset===0){buffer[5]=paths.length;paths.forEach(function(element,index){buffer.writeUInt32BE(element,6+4*index)});rawTx.copy(buffer,6+4*paths.length,offset,offset+chunkSize)}else{rawTx.copy(buffer,5,offset,offset+chunkSize)}apdus.push(buffer.toString("hex"));offset+=chunkSize};while(offset!==rawTx.length){_loop()}return(0,_utils.foreach)(apdus,function(apdu){return _this.comm.exchange(apdu,[36864]).then(function(apduResponse){response=apduResponse})}).then(function(){response=new Buffer(response,"hex");var v=response.slice(0,1).toString("hex");var r=response.slice(1,1+32).toString("hex");var s=response.slice(1+32,1+32+32).toString("hex");return{v:v,r:r,s:s}})}},{key:"getAppConfiguration_async",value:function getAppConfiguration_async(){var buffer=new Buffer(5);buffer[0]=224;buffer[1]=6;buffer[2]=0;buffer[3]=0;buffer[4]=0;return this.comm.exchange(buffer.toString("hex"),[36864]).then(function(responseHex){var result={};var response=Buffer.from(responseHex,"hex");result.arbitraryDataEnabled=response[0]&1;result.version=""+response[1]+"."+response[2]+"."+response[3];return result})}},{key:"signPersonalMessage_async",value:function signPersonalMessage_async(path,messageHex){var _this2=this;var paths=(0,_utils.splitPath)(path);var offset=0;var message=new Buffer(messageHex,"hex");var apdus=[];var response=[];var _loop2=function _loop2(){var maxChunkSize=offset===0?150-1-paths.length*4-4:150;var chunkSize=offset+maxChunkSize>message.length?message.length-offset:maxChunkSize;var buffer=new Buffer(offset===0?5+1+paths.length*4+4+chunkSize:5+chunkSize);buffer[0]=224;buffer[1]=8;buffer[2]=offset===0?0:128;buffer[3]=0;buffer[4]=offset===0?1+paths.length*4+4+chunkSize:chunkSize;if(offset===0){buffer[5]=paths.length;paths.forEach(function(element,index){buffer.writeUInt32BE(element,6+4*index)});buffer.writeUInt32BE(message.length,6+4*paths.length);message.copy(buffer,6+4*paths.length+4,offset,offset+chunkSize)}else{message.copy(buffer,5,offset,offset+chunkSize)}apdus.push(buffer.toString("hex"));offset+=chunkSize};while(offset!==message.length){_loop2()}return(0,_utils.foreach)(apdus,function(apdu){return _this2.comm.exchange(apdu,[36864]).then(function(apduResponse){response=apduResponse})}).then(function(){response=new Buffer(response,"hex");var v=response[0];var r=response.slice(1,1+32).toString("hex");var s=response.slice(1+32,1+32+32).toString("hex");return{v:v,r:r,s:s}})}}]);return LedgerEth}();exports.default=LedgerEth}).call(this,require("buffer").Buffer)},{"./utils":6,buffer:8}],5:[function(require,module,exports){"use strict";var _LedgerCommU2F=require("./LedgerCommU2F");var _LedgerCommU2F2=_interopRequireDefault(_LedgerCommU2F);var _LedgerBtc=require("./LedgerBtc");var _LedgerBtc2=_interopRequireDefault(_LedgerBtc);var _LedgerEth=require("./LedgerEth");var _LedgerEth2=_interopRequireDefault(_LedgerEth);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}module.exports={comm_u2f:_LedgerCommU2F2.default,btc:_LedgerBtc2.default,eth:_LedgerEth2.default}},{"./LedgerBtc":1,"./LedgerCommU2F":3,"./LedgerEth":4}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.defer=defer;exports.eachSeries=eachSeries;exports.splitPath=splitPath;exports.foreach=foreach;exports.doIf=doIf;exports.asyncWhile=asyncWhile;function defer(){var resolve=void 0,reject=void 0;var promise=new Promise(function(success,failure){resolve=success;reject=failure});if(!resolve||!reject)throw"defer() error";return{promise:promise,resolve:resolve,reject:reject}}function eachSeries(arr,fun){return arr.reduce(function(p,e){return p.then(function(){return fun(e)})},Promise.resolve())}function splitPath(path){var result=[];var components=path.split("/");components.forEach(function(element){var number=parseInt(element,10);if(isNaN(number)){return}if(element.length>1&&element[element.length-1]==="'"){number+=2147483648}result.push(number)});return result}function foreach(arr,callback){function iterate(index,array,result){if(index>=array.length){return result}else return callback(array[index],index).then(function(res){result.push(res);return iterate(index+1,array,result)})}return Promise.resolve().then(function(){return iterate(0,arr,[])})}function doIf(condition,callback){return Promise.resolve().then(function(){if(condition){return callback()}})}function asyncWhile(predicate,callback){function iterate(result){if(!predicate()){return result}else{return callback().then(function(res){result.push(res);return iterate(result)})}}return Promise.resolve([]).then(iterate)}},{}],7:[function(require,module,exports){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function placeHoldersCount(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}return b64[len-2]==="="?2:b64[len-1]==="="?1:0}function byteLength(b64){return b64.length*3/4-placeHoldersCount(b64)}function toByteArray(b64){var i,l,tmp,placeHolders,arr;var len=b64.length;placeHolders=placeHoldersCount(b64);arr=new Arr(len*3/4-placeHolders);l=placeHolders>0?len-4:len;var L=0;for(i=0;i<l;i+=4){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[L++]=tmp>>16&255;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}if(placeHolders===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[L++]=tmp&255}else if(placeHolders===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[L++]=tmp>>8&255;arr[L++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16)+(uint8[i+1]<<8)+uint8[i+2];output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var output="";var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];output+=lookup[tmp>>2];output+=lookup[tmp<<4&63];output+="=="}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];output+=lookup[tmp>>10];output+=lookup[tmp>>4&63];output+=lookup[tmp<<2&63];output+="="}parts.push(output);return parts.join("")}},{}],8:[function(require,module,exports){"use strict";var base64=require("base64-js");var ieee754=require("ieee754");exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports.kMaxLength=K_MAX_LENGTH;Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport();if(!Buffer.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function"){console.error("This browser lacks typed array (Uint8Array) support which is required by "+"`buffer` v5.x. Use `buffer` v4.x if you require old browser support.")}function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42}catch(e){return false}}function createBuffer(length){if(length>K_MAX_LENGTH){throw new RangeError("Invalid typed array length")}var buf=new Uint8Array(length);buf.__proto__=Buffer.prototype;return buf}function Buffer(arg,encodingOrOffset,length){if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}if(typeof Symbol!=="undefined"&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true,enumerable:false,writable:false})}Buffer.poolSize=8192;function from(value,encodingOrOffset,length){if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(isArrayBuffer(value)){return fromArrayBuffer(value,encodingOrOffset,length)}if(typeof value==="string"){return fromString(value,encodingOrOffset)}return fromObject(value)}Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)};Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be a number')}else if(size<0){throw new RangeError('"size" argument must not be negative')}}function alloc(size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill)}return createBuffer(size)}Buffer.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)};function allocUnsafe(size){assertSize(size);return createBuffer(size<0?0:checked(size)|0)}Buffer.allocUnsafe=function(size){return allocUnsafe(size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)};function fromString(string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError('"encoding" must be a valid string encoding')}var length=byteLength(string,encoding)|0;var buf=createBuffer(length);var actual=buf.write(string,encoding);if(actual!==length){buf=buf.slice(0,actual)}return buf}function fromArrayLike(array){var length=array.length<0?0:checked(array.length)|0;var buf=createBuffer(length);for(var i=0;i<length;i+=1){buf[i]=array[i]&255}return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError("'offset' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("'length' is out of bounds")}var buf;if(byteOffset===undefined&&length===undefined){buf=new Uint8Array(array)}else if(length===undefined){buf=new Uint8Array(array,byteOffset)}else{buf=new Uint8Array(array,byteOffset,length)}buf.__proto__=Buffer.prototype;return buf}function fromObject(obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;var buf=createBuffer(len);if(buf.length===0){return buf}obj.copy(buf,0,0,len);return buf}if(obj){if(isArrayBufferView(obj)||"length"in obj){if(typeof obj.length!=="number"||numberIsNaN(obj.length)){return createBuffer(0)}return fromArrayLike(obj)}if(obj.type==="Buffer"&&Array.isArray(obj.data)){return fromArrayLike(obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=K_MAX_LENGTH){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+K_MAX_LENGTH.toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return b!=null&&b._isBuffer===true};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!Array.isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(isArrayBufferView(string)||isArrayBuffer(string)){return string.byteLength}if(typeof string!=="string"){string=""+string}var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case undefined:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(numberIsNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new TypeError("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset>>>0;if(isFinite(length)){length=length>>>0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;byteLength=byteLength>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,255,0);this[offset]=value&255;return offset+1};Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255;return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24;return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,4,3.4028234663852886e38,-3.4028234663852886e38)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,8,1.7976931348623157e308,-1.7976931348623157e308)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else if(len<1e3){for(i=0;i<len;++i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(val.length===1){var code=val.charCodeAt(0);if(code<256){val=code}}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:new Buffer(val,encoding);var len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function base64clean(str){str=str.trim().replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isArrayBuffer(obj){return obj instanceof ArrayBuffer||obj!=null&&obj.constructor!=null&&obj.constructor.name==="ArrayBuffer"&&typeof obj.byteLength==="number"}function isArrayBufferView(obj){return typeof ArrayBuffer.isView==="function"&&ArrayBuffer.isView(obj)}function numberIsNaN(obj){return obj!==obj}},{"base64-js":7,ieee754:9}],9:[function(require,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},{}],10:[function(require,module,exports){"use strict";module.exports=require("./lib/u2f-api")},{"./lib/u2f-api":12}],11:[function(require,module,exports){"use strict";var u2f=u2f||{};module.exports=u2f;u2f.EXTENSION_ID="kmendfapggjehodndflmmgagdbamhnfd";u2f.MessageTypes={U2F_REGISTER_REQUEST:"u2f_register_request",U2F_SIGN_REQUEST:"u2f_sign_request",U2F_REGISTER_RESPONSE:"u2f_register_response",U2F_SIGN_RESPONSE:"u2f_sign_response"};u2f.ErrorCodes={OK:0,OTHER_ERROR:1,BAD_REQUEST:2,CONFIGURATION_UNSUPPORTED:3,DEVICE_INELIGIBLE:4,TIMEOUT:5};u2f.Request;u2f.Response;u2f.Error;u2f.SignRequest;u2f.SignResponse;u2f.RegisterRequest;u2f.RegisterResponse;u2f.disconnect=function(){if(u2f.port_&&u2f.port_.port_){u2f.port_.port_.disconnect();u2f.port_=null}};u2f.getMessagePort=function(callback){if(typeof chrome!="undefined"&&chrome.runtime){var msg={type:u2f.MessageTypes.U2F_SIGN_REQUEST,signRequests:[]};chrome.runtime.sendMessage(u2f.EXTENSION_ID,msg,function(){if(!chrome.runtime.lastError){u2f.getChromeRuntimePort_(callback)}else{u2f.getIframePort_(callback)}})}else{u2f.getIframePort_(callback)}};u2f.getChromeRuntimePort_=function(callback){var port=chrome.runtime.connect(u2f.EXTENSION_ID,{includeTlsChannelId:true});setTimeout(function(){callback(null,new u2f.WrappedChromeRuntimePort_(port))},0)};u2f.WrappedChromeRuntimePort_=function(port){this.port_=port};u2f.WrappedChromeRuntimePort_.prototype.postMessage=function(message){this.port_.postMessage(message)};u2f.WrappedChromeRuntimePort_.prototype.addEventListener=function(eventName,handler){var name=eventName.toLowerCase();if(name=="message"||name=="onmessage"){this.port_.onMessage.addListener(function(message){handler({data:message})})}else{console.error("WrappedChromeRuntimePort only supports onMessage")}};u2f.getIframePort_=function(callback){var iframeOrigin="chrome-extension://"+u2f.EXTENSION_ID;var iframe=document.createElement("iframe");iframe.src=iframeOrigin+"/u2f-comms.html";iframe.setAttribute("style","display:none");document.body.appendChild(iframe);var hasCalledBack=false;var channel=new MessageChannel;var ready=function(message){if(message.data=="ready"){channel.port1.removeEventListener("message",ready);if(!hasCalledBack){hasCalledBack=true;callback(null,channel.port1)}}else{console.error('First event on iframe port was not "ready"')}};channel.port1.addEventListener("message",ready);channel.port1.start();iframe.addEventListener("load",function(){iframe.contentWindow.postMessage("init",iframeOrigin,[channel.port2])});setTimeout(function(){if(!hasCalledBack){hasCalledBack=true;callback(new Error("IFrame extension not supported"))}},200)};u2f.EXTENSION_TIMEOUT_SEC=30;u2f.port_=null;u2f.waitingForPort_=[];u2f.reqCounter_=0;u2f.callbackMap_={};u2f.getPortSingleton_=function(callback){if(u2f.port_){callback(null,u2f.port_)}else{if(u2f.waitingForPort_.length==0){u2f.getMessagePort(function(err,port){if(!err){u2f.port_=port;u2f.port_.addEventListener("message",u2f.responseHandler_)}while(u2f.waitingForPort_.length)u2f.waitingForPort_.shift()(err,port)})}u2f.waitingForPort_.push(callback)}};u2f.responseHandler_=function(message){var response=message.data;var reqId=response["requestId"];if(!reqId||!u2f.callbackMap_[reqId]){console.error("Unknown or missing requestId in response.");return}var cb=u2f.callbackMap_[reqId];delete u2f.callbackMap_[reqId];cb(null,response["responseData"])};u2f.isSupported=function(callback){u2f.getPortSingleton_(function(err,port){callback(!err)})};u2f.sign=function(signRequests,callback,opt_timeoutSeconds){u2f.getPortSingleton_(function(err,port){if(err)return callback(err);var reqId=++u2f.reqCounter_;u2f.callbackMap_[reqId]=callback;var req={type:u2f.MessageTypes.U2F_SIGN_REQUEST,signRequests:signRequests,timeoutSeconds:typeof opt_timeoutSeconds!=="undefined"?opt_timeoutSeconds:u2f.EXTENSION_TIMEOUT_SEC,requestId:reqId};port.postMessage(req)})};u2f.register=function(registerRequests,signRequests,callback,opt_timeoutSeconds){u2f.getPortSingleton_(function(err,port){if(err)return callback(err);var reqId=++u2f.reqCounter_;u2f.callbackMap_[reqId]=callback;var req={type:u2f.MessageTypes.U2F_REGISTER_REQUEST,signRequests:signRequests,registerRequests:registerRequests,timeoutSeconds:typeof opt_timeoutSeconds!=="undefined"?opt_timeoutSeconds:u2f.EXTENSION_TIMEOUT_SEC,requestId:reqId};port.postMessage(req)})}},{}],12:[function(require,module,exports){(function(global){"use strict";module.exports=API;var chromeApi=require("./google-u2f-api");var isBrowser=typeof navigator!=="undefined"&&!!navigator.userAgent;var isSafari=isBrowser&&navigator.userAgent.match(/Safari\//)&&!navigator.userAgent.match(/Chrome\//);var isEDGE=isBrowser&&navigator.userAgent.match(/Edge\/1[2345]/);var _backend=null;function getBackend(Promise){if(!_backend)_backend=new Promise(function(resolve,reject){function notSupported(){resolve({u2f:null,native:true})}if(!isBrowser)return notSupported();if(isSafari)return notSupported();var hasNativeSupport=typeof window.u2f!=="undefined"&&typeof window.u2f.sign==="function";if(hasNativeSupport)resolve({u2f:window.u2f,native:true});if(isEDGE)return notSupported();if(location.protocol==="http:")return notSupported();if(typeof MessageChannel==="undefined")return notSupported();chromeApi.isSupported(function(ok){if(ok)resolve({u2f:chromeApi,native:false});else notSupported()})});return _backend}function API(Promise){return{isSupported:isSupported.bind(Promise),ensureSupport:ensureSupport.bind(Promise),register:register.bind(Promise),sign:sign.bind(Promise),ErrorCodes:API.ErrorCodes,ErrorNames:API.ErrorNames}}API.ErrorCodes={CANCELLED:-1,OK:0,OTHER_ERROR:1,BAD_REQUEST:2,CONFIGURATION_UNSUPPORTED:3,DEVICE_INELIGIBLE:4,TIMEOUT:5};API.ErrorNames={"-1":"CANCELLED",0:"OK",1:"OTHER_ERROR",2:"BAD_REQUEST",3:"CONFIGURATION_UNSUPPORTED",4:"DEVICE_INELIGIBLE",5:"TIMEOUT"};function makeError(msg,err){var code=err!=null?err.errorCode:1;var type=API.ErrorNames[""+code];var error=new Error(msg);error.metaData={type:type,code:code};return error}function deferPromise(Promise,promise){var ret={};ret.promise=new Promise(function(resolve,reject){ret.resolve=resolve;ret.reject=reject;promise.then(resolve,reject)});ret.promise.cancel=function(msg,disconnect){getBackend(Promise).then(function(backend){if(disconnect&&!backend.native)backend.u2f.disconnect();ret.reject(makeError(msg,{errorCode:-1}))})};return ret}function defer(Promise,fun){return deferPromise(Promise,new Promise(function(resolve,reject){try{fun&&fun(resolve,reject)}catch(err){reject(err)}}))}function isSupported(){var Promise=this;return getBackend(Promise).then(function(backend){return!!backend.u2f})}function _ensureSupport(backend){if(!backend.u2f){if(location.protocol==="http:")throw new Error("U2F isn't supported over http, only https");throw new Error("U2F not supported")}}function ensureSupport(){var Promise=this;return getBackend(Promise).then(_ensureSupport)}function register(registerRequests,signRequests,timeout){var Promise=this;if(!Array.isArray(registerRequests))registerRequests=[registerRequests];if(typeof signRequests==="number"&&typeof timeout==="undefined"){timeout=signRequests;signRequests=null}if(!signRequests)signRequests=[];return deferPromise(Promise,getBackend(Promise).then(function(backend){_ensureSupport(backend);var native=backend.native;var u2f=backend.u2f;return new Promise(function(resolve,reject){function cbNative(response){if(response.errorCode)reject(makeError("Registration failed",response));else{delete response.errorCode;resolve(response)}}function cbChrome(err,response){if(err)reject(err);else if(response.errorCode)reject(makeError("Registration failed",response));else resolve(response)}if(native){var appId=registerRequests[0].appId;u2f.register(appId,registerRequests,signRequests,cbNative,timeout)}else{u2f.register(registerRequests,signRequests,cbChrome,timeout)}})})).promise}function sign(signRequests,timeout){var Promise=this;if(!Array.isArray(signRequests))signRequests=[signRequests];return deferPromise(Promise,getBackend(Promise).then(function(backend){_ensureSupport(backend);var native=backend.native;var u2f=backend.u2f;return new Promise(function(resolve,reject){function cbNative(response){if(response.errorCode)reject(makeError("Sign failed",response));else{delete response.errorCode;resolve(response)}}function cbChrome(err,response){if(err)reject(err);else if(response.errorCode)reject(makeError("Sign failed",response));else resolve(response)}if(native){var appId=signRequests[0].appId;var challenge=signRequests[0].challenge;u2f.sign(appId,challenge,signRequests,cbNative,timeout)}else{u2f.sign(signRequests,cbChrome,timeout)}})})).promise}function makeDefault(func){API[func]=function(){if(!global.Promise)throw new Error("The platform doesn't natively support promises");var args=[].slice.call(arguments);return API(global.Promise)[func].apply(null,args)}}makeDefault("isSupported");makeDefault("ensureSupport");makeDefault("register");makeDefault("sign")}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./google-u2f-api":11}]},{},[5])(5)});